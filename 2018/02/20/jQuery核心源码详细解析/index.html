<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">










  <meta name="google-site-verification" content="true">







  <meta name="baidu-site-verification" content="true">











<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="一直以来，工作中用到的工具就是jquery，之前也看过源码，但是没有对jquery系统地学习、总结过，虽然现在前端新的技术层出不穷，但jquery里的设计思想和编码技巧还是需要学习、借鉴的，这次趁着过年的时间抽空把jquery源码系统地学习了一遍，由于时间不是很充裕，所以只是把核心源码分析了一下：">
<meta name="keywords" content="jquery 源码 框架 库 源代码 学习">
<meta property="og:type" content="article">
<meta property="og:title" content="jquery核心代码详细解析">
<meta property="og:url" content="http://www.icrazyman.cn/2018/02/20/jQuery核心源码详细解析/index.html">
<meta property="og:site_name" content="科瑞兹曼的博客">
<meta property="og:description" content="一直以来，工作中用到的工具就是jquery，之前也看过源码，但是没有对jquery系统地学习、总结过，虽然现在前端新的技术层出不穷，但jquery里的设计思想和编码技巧还是需要学习、借鉴的，这次趁着过年的时间抽空把jquery源码系统地学习了一遍，由于时间不是很充裕，所以只是把核心源码分析了一下：">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-03-26T16:26:41.590Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jquery核心代码详细解析">
<meta name="twitter:description" content="一直以来，工作中用到的工具就是jquery，之前也看过源码，但是没有对jquery系统地学习、总结过，虽然现在前端新的技术层出不穷，但jquery里的设计思想和编码技巧还是需要学习、借鉴的，这次趁着过年的时间抽空把jquery源码系统地学习了一遍，由于时间不是很充裕，所以只是把核心源码分析了一下：">



  <link rel="alternate" href="/atom.xml" title="科瑞兹曼的博客" type="application/atom+xml">




  <link rel="canonical" href="http://www.icrazyman.cn/2018/02/20/jQuery核心源码详细解析/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>jquery核心代码详细解析 | 科瑞兹曼的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">科瑞兹曼的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">专注于前端开发技术</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
    
  
  

  

  <article class="post post-type-normal true" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.icrazyman.cn/2018/02/20/jQuery核心源码详细解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="科瑞兹曼">
      <meta itemprop="description" content="交流、学习、提升">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="科瑞兹曼的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">jquery核心代码详细解析

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-02-20 21:10:08" itemprop="dateCreated datePublished" datetime="2018-02-20T21:10:08+08:00">2018-02-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-03-27 00:26:41" itemprop="dateModified" datetime="2018-03-27T00:26:41+08:00">2018-03-27</time>
              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2018/02/20/jQuery核心源码详细解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/02/20/jQuery核心源码详细解析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/2018/02/20/jQuery核心源码详细解析/" class="leancloud_visitors" data-flag-title="jquery核心代码详细解析">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>一直以来，工作中用到的工具就是jquery，之前也看过源码，但是没有对jquery系统地学习、总结过，虽然现在前端新的技术层出不穷，但jquery里的设计思想和编码技巧还是需要学习、借鉴的，这次趁着过年的时间抽空把jquery源码系统地学习了一遍，由于时间不是很充裕，所以只是把核心源码分析了一下：</p>
<a id="more"></a>
<pre><code>( function ( window, undefined ){//沙箱模式
  //在ie中undefined可以被重写，所以形参把undefined传进来实参不传，以保证undefined本身不会被重写

  var  arr = [], push = arr.push, slice = arr.slice;

  //调用原型的init方法，返回DOM元素伪数组
  function $ ( html ){
    return new $.fn.init( html );
  }

  //给原型添加init方法，伪数组
  //给prototype取个别名fn
  $.fn = $.prototype = {
    constructor: $,//替换原型要手动添加constructor
    length: 0,
    selector: &#39;&#39;,
    type: &#39;$&#39;,
    init: function( html ){//初始化
      //如果参数为空  null undefined
      if ( html == null || html === &#39;&#39; ) {
        this.events = {};
        return;
      };

      //如果参数是函数(入口函数)
      if ( typeof html === &#39;function&#39; ) {
        var oldFn = window.onload;
        if ( typeof oldFn === &#39;function&#39; ) {
          window.onload = function(){
            oldFn();
            html();
          }
        }else{
          window.onload = html;
        }
        return;
      };

      //如果参数是字符串
      if ( $.isString( html )) {
        if ( /^&lt;/.test( html )) {
          push.apply( this, parseHTML( html ));
        }else{//如果是标签选择器
          push.apply( this, $.select( html ));
          this.selector = html;
        }
      }

      //如果是$对象,将传入的$对象所有元素都加到this中
      if ( html &amp;&amp; html.type === &#39;$&#39; ) {
        push.apply( this, html );
        this.selector = html.selector;
        this.events = html.events;
        return this;
      };

      //如果是DOM对象
      if ( html.nodeType ) {
        this[ 0 ] = html;
        push.call( this[ 0 ], html );
      };
      this.events = {};
    },
    toArray: function(){
      return slice.call( this, 0 );
    },
    get: function( index ){
      if ( index === undefined ) {
        return this.toArray();
      };
      return this[ index ];
    },
    eq: function( num ){
      var dom;
      if ( num &gt;= 0 ) {
        dom = this.get( num );
      }else{
        dom = this.get( this.length + num );
      }
      return $( dom );
      // return this.constructor( dom );//包装成一个$对象
    },
    each: function( func ){
      return $.each( this, func );
    },
    map: function( func ){
      return $.map( this, func );
    }
  };
  //让init拥有$.prototype的方法，就让原型与$.prototype的指向相同
  //这样就有appendTo方法
  $.fn.init.prototype = $.fn;

  //添加自定义可扩展的方法extend(混入式继承)
  $.extend = $.fn.extend = function ( obj ){
    for ( var k in obj ){
      this[ k ] = obj[ k ];
    }
  };

  //自己封装的基本、并集、后代选择器引擎
  var select3 = (function(){
    //尝试用数组自带push方法，如果没有的话就自己定义一个
    try {
      var div = document.createElement( &#39;div&#39; );
      div.innerHTML = &#39;&lt;p&gt;&lt;/p&gt;&#39;;
      var arr = [];
      push.apply( arr, div.getElementsByTagName( &#39;p&#39; ));
    }catch ( e ){//如果不支持push方法就自己定义
      push = {
        apply: function ( array1, array2 ){
          for (var i = 0; i &lt; array2.length; i++) {
            //把array2添加到array1中
            array1[ array1.length++ ] = array2[ i ];
          };
        }
      }
    }

    //正则表达式
    var rnative = /\{\s*\[native/;//匹配浏览器支持就返回{ [native code] }
    var rtrim = /^\s+|\s+$/;//匹配字符串两端空格
    //        ?:匹配但不捕获      id:1      class:2   *:3  tag:4
    var rbaseselector = /^(?:\#([\w\-]+)|\.([\w\-]+)|(\*)|(\w+))$/;

    //浏览器能力检测
    var support = {};
    support.qsa = rnative.test( document.querySelectorAll + &#39;&#39;);//转换字符串
    support.getElementsByClassName = rnative.test( document.getElementsByClassName + &#39;&#39;);
    support.trim = rnative.test( String.prototype.trim + &#39;&#39;);

    //通过类名获取元素的兼容性写法
    function getByClassName( className, node ){
      node = node || document;
      var allElem, res = [], i;
      if ( support.getElementsByClassName ){//如果浏览器支持
        return node.getElementsByClassName( className );
      }else{//不支持
        allElem = document.getElementsByTagName( &#39;*&#39; );
        for (i = 0; i &lt; allElem.length; i++) {
          if (( &#39; &#39; + allElem[ i ].className + &#39; &#39; ).indexOf( &#39; &#39; + className + &#39; &#39; ) &gt; -1 ) {
            res.push( allElem[ i ] );
          };
        };
        return res;
      }
    }

    //自定义实现trim方法(去两端空格)
    function myTrim( str ){
      if ( support.trim ) {
        return str.trim();
      }else{
        return str.replace( rTrim, &#39; &#39; );
      }
    }

    //自定义indexOf方法
    function myIndexOf ( array, search, startIndex ){
      startIndex = startIndex || 0;//设置开始查找索引默认值
      if ( support.indexOf ) {
        return array.IndexOf( search, startIndex );
      }else{
        for (var i = 0; i &lt; array.length; i++) {
          if ( array[ i ] === search ) {
            return i;
          };
        };
        return -1;
      }
    }

    //数组去重
    var unique = function( array ){
      var resArray = [], i = 0;
      for (; i &lt; array.length; i++) {
        if ( myIndexOf( resArray, array[ i ]) === -1 ) {
          resArray.push( array[ i ]);
        };
      };
      return resArray;
    }

    //基本选择器
    function basicSelect( selector, node ){
      node = node || document;
      var m, res;
      if ( m = rbaseselector.exec( selector )) {
        if ( m[ 1 ]) {//id
          res = document.getElementById( m[ 1 ] );
          return res ? [ res ] : [];//如果没获取到就返回空数组
        }else if ( m[ 2 ]) {//class
          return getByClassName( m[ 2 ], node );
        }else if ( m[ 3 ]) {//*
          return node.getElementsByTagName( m[ 3 ] );
        }else{//tag
          return node.getElementsByTagName( m[ 4 ] );
        }
      };
    }

    //后代选择器
    function select2( selector, results ){
      results = results || [];//如果没传该参数就默认为[]
      var selectors = selector.split( &#39; &#39; );//分割成数组
      var arr = [], node = [ document ], i, j;
    /**假设&#39;div p .c&#39; 外层循环控制选择器的迭代次数(3次),node = arr控制内层循环的次数
     *第一次在document下查找div并把数组添加到node中
     *arr.push.apply(arr,basicSelect(&#39;div&#39;,&#39;document&#39;));
     *==&gt;arr:[&#39;div&#39;]==&gt;node:[&#39;div&#39;]==&gt;arr:[]
     *第二次在node成员div下查找p并把p添加到node中
     *arr.push.apply(arr,basicSelect(&#39;p&#39;,&#39;div&#39;));
     *==&gt;arr:[&#39;p&#39;]==&gt;node:[&#39;p&#39;]==&gt;arr:[]
     *第三次在node成员div或者p下查找.c并把.c添加到node中
     *arr.push.apply(arr,basicSelect(&#39;.c&#39;,&#39;p&#39;));
     *==&gt;arr:[&#39;.c&#39;]==&gt;node:[&#39;.c&#39;]==&gt;arr:[]
     */
      for (i = 0; i &lt; selectors.length; i++) {
        for (j = 0; j &lt; node.length; j++) {
          arr.push.apply( arr, basicSelect( selectors[ i ], node[ j ] ));
        };
        //下面重置的两句代码的位置影响到性能问题
        node = arr;//把当前获取的元素保存到node中
        arr = [];//初始化arr
      };
      results.push.apply( results, node );//把获取的元素添加到结果中
      return results;
    }

    //核心功能
    function select( selector, results ){
      results = results || [];
      var m, temp, selectors, subSelector, i;
      //如果实参不是字符串
      if ( typeof selector != &#39;string&#39; ) return results;
      //判断是否支持qsa
      if ( support.qsa ) {
        results.push.apply( results, document.querySelectorAll( selector ) );
      }else{
        selectors = selector.splitL( &#39;,&#39; );//用逗号分割传入的参数
        for (i = 0; i &lt; selectors.length; i++) {//遍历选择器
          subSelector = myTrim( selectors[ i ]);//去掉两端空格
          if ( rbaseselector.test( subSelector )) {//如果参数是基本选择器
            //通过匹配捕获把获取到的元素添加到数组中
            results.push.apply( results, basicSelect( subSelector ));
          }else{//如果是后代选择器
            select2( subSelector, results );//执行后代选择器
          }
        };
      }
      return unique( results );//把获取的重复的元素去掉
    }
    return select;//返回select方法体，供函数外部使用
  })();

  //把选择器引擎里的核心函数API暴露出来，在需要的时候可以使用第三方的选择器引擎
  //给$对象添加自定义属性select指向已声明的选择器引擎
  $.select = select3;

  //给构造函数$添加静态方法。 实例方法
  $.extend({
    getStyle: function(){
      if ( o.currentStyle ) {
        return o.currentStyle[ name ];
      }else{
        return window.getComputedStyle( o )[ name ];
      }
    },
    isString: function( data ){
      return typeof data === &#39;string&#39;;
    },
    each: function( arr, func ){
      var i;
      //在es5中还引入了Array.isArray的方法专门来判断数组
      if ( arr instanceof Array || arr.length &gt;= 0 ) {
        for ( i = 0; i &lt; arr.length; i++ ) {
          func.call( arr[ i ], i, arr[ i ] );
        };
      }else{
        for ( i in arr ){
          func.call( arr[ i ], i, arr[ i ] );
        }
      }
      return arr;//返回，链式编程
    },
    map: function( arr, func ){
      var res = [], i, tmp;
      if ( arr instanceof Array || arr.length &gt;= 0 ) {
         for (i = 0; i &lt; arr.length; i++) {
            tmp = func.call( arr[ i ], arr[ i ], i );
            if ( tmp != null ) {
               res.push( tmp );
            };
         };
      }else{
         for ( i in arr ){
            tmp = func.call( arr[ i ], arr[ i ], i );
            if ( tmp != null ) {
               res.push( tmp );
            };
         };
      };
    return res;
    },
    prependChild: function ( parent, element ){
      parent.insertBefore( element, parent.firstChid );
    }
  });

  //DOM操作的方法，将字符串转换为DOM对象的函数
  var parseHTML = (function(){
    var div = document.createElement( &#39;div&#39; );
    function parseHTML ( html ){
      div.innerHTML = html;
      var res = [], i;
      for ( i = 0; i &lt; div.childNodes.length; i++ ) {
        res.push( div.childNodes[ i ] );
      };
      div.innerHTML = &#39;&#39;;
      return res;
    }
    return parseHTML;
  })();

  //给构造函数$添加静态方法
  $.extend({
    isString: function( data ){
      return typeof data === &#39;string&#39;;
    },
    each: function( arr, func ){
      var i;
      // 在 ES5 中还引入了 Array.isArray 的方法专门来判断数组
      if ( arr instanceof Array || arr.length &gt;= 0 ) {
         for ( i = 0; i &lt; arr.length; i++ ) {
            func.call( arr[ i ], i, arr[ i ] );
         }
      }else{
         for ( i in arr ){
            func.call( arr[ i ], i, arr[ i ] );
         }
      }
      return arr;//返回原数组/对象
    },
    map: function( arr, func ){
      var res = [], i, tmp;
      if ( arr instanceof Array || arr.length &gt;= 0 ) {
         for (i = 0; i &lt; arr.length; i++) {
            tmp = func.call( arr[ i ], arr[ i ], i );
            if ( tmp != null ) {
               res.push( tmp );
            };
         };
      }else{
         for ( i in arr ){
            tmp = func.call( arr[ i ], arr[ i ], i );
            if ( tmp != null ) {
               res.push( tmp );
            };
         };
      };
      return res;
    },
    prependChild: function ( parent, element ){
      parent.insertBefore( element, parent.firstChild );
    },
    getStyle: function( o, name ){
      if ( o.currentStyle ) {
        return o.currentStyle[ name ];
      }else{
        return window.getComputedStyle( o )[ name ];
      }
    }
  });

  //DOM操作的方法，将字符串转换为DOM对象的函数
  var parseHTML = (function (){
    var div = document.createElement( &#39;div&#39; );
    function parseHTML ( html ) {
      div.innerHTML = html;
      var res = [];//保存到数组中方便调取各个节点
      for (var i = 0; i &lt; div.childNodes.length; i++) {
        res.push( div.childNodes[ i ] );
      };
      div.innerHTML = &#39;&#39;;
      return res;
    }
    return parseHTML;
  })();

  //实例方法
  $.fn.extend({
    appendTo: function ( selector ){
      //把selector包装成$对象（伪数组）
      var iObj = this.constructor( selector );
      //利用新对象保存数据然后改变this指向
      var newObj = this.constructor();
      console.log(this);//指向前面添加的的span元素(伪数组)
      // A appendTo B     this指向A
      for ( var i = 0; i &lt; this.length; i++ ) {
        for ( var j = 0; j &lt; iObj.length; j++ ) {
          //最后一次会多克隆一次，所以最后一次就不克隆
          var temp =
            i == this.length - 1 &amp;&amp; j == iObj.length - 1
              ? this[ i ]
              : this[ i ].cloneNode( true );
          //改变this指向实现链式编程
          [].push.call( newObj, temp );
          iObj[ j ].appendChild( temp );
        };
      };
      return newObj;
    },
    append: function ( selector ){
      //$( selector ).appendTo( this );//简化版
      var iObj = this.constructor( selector );
      // B append A this 的指向B
      for (var i = 0; i &lt; iObj.length; i++) {
        for (var j = 0; j &lt; this.length; j++) {
          var temp =
            i == this.length - 1 &amp;&amp; j == iObj.length - 1
              ? iObj[ i ]
              : iObj[ i ].cloneNode( true );
          this[ j ].appendChild( temp );
        };
      };
      return this;
    },
    prependTo: function ( selector ){
      //把selector包装成$对象（伪数组）
      var iObj = this.constructor( selector );
      //利用新对象保存数据然后改变this指向
      var newObj = this.constructor();//$.fn.constructor也行
      for (var i = 0; i &lt; this.length; i++) {
        for (var j = 0; j &lt; iObj.length; j++) {
          //最后一次会多克隆一次，所以最后一次就不克隆
          var temp =
            i == this.length - 1 &amp;&amp; j == iObj.length - 1
              ? this[ i ]
              : this[ i ].cloneNode( true );
          //改变this指向实现链式编程
          [].push.call( newObj, temp );
          prependChild( iObj[ j ], temp );
        };
      };
      return newObj;
    },
    prepend: function ( selector ){
      this.constructor( selector ).prependTo( this );
      return this;
    },
    on: function( type, fn ){
      if ( !this.events[ type ]) {//如果事件对象不存在就置空
        this.events[ type ] = [];
        var that = this;//指向的是该数组
        this.each( function() {
          var self = this;//this指向每一个DOM对象
          var f = function ( e ){
            //把事件对象e传进每个绑定的事件里
            for (var i = 0; i &lt; that.events[ type ].length; i++) {
              that.events[ type ][ i ].call( self, e );
            };
          }
          if ( this.addEventListener ) {
            this.addEventListener( type, f );
          }else{
            this.attachEvent( &#39;on&#39; + type, f );//兼容ie6，7，8浏览器
          }
        });
      };
      this.events[ type ].push( fn );//给events对象type属性(数组)添加传入的事件
      return this;
    },
    off: function( type, fn){
      var arr = this.events[ type ];//事件数组
      if ( arr ) {
        for (var i = 0; i &lt; arr.length; i++) {
          if ( arr[ i ] == fn ) {
            break;
          };
        };
        if ( i != arr.length ) {
          arr.aplice( i, 1 );
        };
      };
      return this;
    },
    css: function( option ){
      var len = arguments.length, args = arguments;
      if ( len === 2 ) {//两个参数
        if ( $.isString( args[ 0 ] ) &amp;&amp; $.isString( args[ 1 ] ) ) {
          return this.each( function(){
            this.style[ args[ 0 ] ] = args[ 1 ];
          })
        };
      }else if ( len === 1 ) {//一个参数
        if ( $.isString( option ) ) {//参数为字符串
          return this[ 0 ].style[ option ] || $.getStyle( this[ 0 ], option );
        }else if ( typeof option == &#39;object&#39;) {//参数为对象
          return this.each( function(){
            for ( var k in option ){
              this.style[ k ] = option[ k ];
            }
          })
        };
      };
      return this;
    },
    addClass: function( name ){
      return this.each( function (){
        var classTxt = this.className;
        if ( classTxt ) {
          if ( ( &#39; &#39; + classTxt + &#39; &#39; ).indexOf( &#39; &#39; + name + &#39; &#39; ) === -1 ) {
            this.className += &#39; &#39; + name;
          }else{

          }
        }else{
          this.className = name;
        }
      })
    },
    removeClass: function ( name ){
      return this.each( function(){
        var classTxt = &#39; &#39; + this.className + &#39; &#39;;
        var rclassName = new RegExp( &#39; &#39; + name + &#39; &#39;, &#39;g&#39; );
        this.className = classTxt.replace( rclassName, &#39; &#39; ).replace( /\s+/g, &#39; &#39; ).trim();
      });
    },
    hasClass: function( name ){
      for ( var i = 0; i &lt; this.length; i++ ) {
        if ( ( &#39; &#39; + this[ i ].className + &#39; &#39; ).indexOf( &#39; &#39; + name + &#39; &#39; ) != -1 ) {
          return true;
        };
      };
      return false;
    },
    toggleClass: function( name ){
      if ( this.hasClass( name )) {
        this.removeClass( name );
      }else{
        this.addClass( name );
      }
      return this;
    },
    attr: function ( name, value ){
      if ( value ) {//设置属性
        if ( $.isString( name ) &amp;&amp; $.isString( value ) ) {
          return this.each( function(){
            this.setAttribute( name, value );
          })
        };
      }else{//获取属性
        if ( $.isString( name ) ) {
          return this[ 0 ].getAttribute( name );
        };
      }
      return this;
    },
    prop: function ( name, value ){
      if ( value ) {
        if ( $.isString( name ) &amp;&amp; $.isString( value ) ) {
          return this.each( function(){
            this[ name ] = value;
          });
        };
      }else{
        if ( $.isString( name ) ) {
          return this[ 0 ][ name ];
        };
      }
      return this;
    },
    val: function( value ){
      return this.attr( &#39;value&#39;, value);
    },
    html: function( html ){
      return this.prop( &#39;innerHTML&#39;, html );
    },
    text: function( txt ){
      if ( txt ) {
        return this.each( function(){
          this.innerHTML = &#39;&#39;;
          this.appendChild( document.createTextNode( txt + &#39;&#39; ));
        })
      }else{
        var arr = [];
        getTxt( this[ 0 ], arr );
        return arr.join( &#39; &#39; );
      }
      return this;

      function getTxt( node, list ){
        var arr = node.childNodes;
        for (var i = 0; i &lt; arr.length; i++) {
          if ( arr[ i ].nodeType === 3 ) {
            list.push( arr[ i ].nodeValue );
          };
          if ( arr[ i ].nodeType === 1 ) {
            getTxt( arr[ i ], list );
          };
        };
      }
    }
  });

  //直接绑定事件的封装
  $.each(( &quot;blur focus focusin focusout load resize scroll unload click dblclick &quot; +
  &quot;mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave &quot; +
  &quot;change select submit keydown keypress keyup error contextmenu&quot; ).split( &#39; &#39; ), function( i, v ){//v表示事件的名称
    $.fn[ v ] = function( fn ){
      this.on( v, fn );
      return this;
    }
  });


window.$ = $;//暴露$

} )( window );
</code></pre>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/jquery-源码-框架-库-源代码-学习/" rel="tag"># jquery 源码 框架 库 源代码 学习</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/20/写一手漂亮的js(react篇)/" rel="next" title="写一手漂亮的js(react篇)">
                <i class="fa fa-chevron-left"></i> 写一手漂亮的js(react篇)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/22/JavaScript难点笔记/" rel="prev" title="JavaScript难点笔记">
                JavaScript难点笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">科瑞兹曼</p>
              <p class="site-description motion-element" itemprop="description">交流、学习、提升</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">61</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">61</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.zhangxinxu.com/wordpress/" title="http://www.zhangxinxu.com/wordpress/" rel="noopener" target="_blank">张鑫旭</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ruanyifeng.com/blog/" title="http://www.ruanyifeng.com/blog/" rel="noopener" target="_blank">阮一峰</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://jstherightway.org/zh-cn/" title="http://jstherightway.org/zh-cn/" rel="noopener" target="_blank">JavaScript之路</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://standardjs.com/readme-zhcn.html" title="https://standardjs.com/readme-zhcn.html" rel="noopener" target="_blank">前端代码规范</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">科瑞兹曼</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: true,
    notify: true,
    appId: 'hXTDTSGSHRts2UhvBgMMCgbT-gzGzoHsz',
    appKey: 'VtFW2O1nWA3hNCVyr56QqvyG',
    placeholder: '我来说两句',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true
  });
</script>




  


  




  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; 
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
